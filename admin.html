<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆé­šç®¡ç†å¾Œå° - ç‡Ÿæ”¶å ±è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f5f5f4; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black text-zinc-900">ğŸŸ åˆé­šç‡Ÿæ”¶ç®¡ç†</h1>
            <button onclick="location.reload()" class="bg-white px-4 py-2 rounded-xl shadow-sm text-sm font-bold hover:bg-zinc-100 transition-all">ğŸ”„ é‡æ–°æ•´ç†</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-zinc-200">
                <p class="text-zinc-500 font-bold mb-1">ä»Šæ—¥ç¸½ç‡Ÿæ¥­é¡</p>
                <h2 class="text-4xl font-black text-red-600">$<span id="total-revenue">0</span></h2>
            </div>
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-zinc-200">
                <p class="text-zinc-500 font-bold mb-1">ä»Šæ—¥è¨‚å–®ç¸½æ•¸</p>
                <h2 class="text-4xl font-black text-zinc-800"><span id="total-orders">0</span> <span class="text-xl">å–®</span></h2>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-sm border border-zinc-200 overflow-hidden">
            <div class="p-6 border-b border-zinc-100 bg-zinc-50">
                <h3 class="font-black text-zinc-700">ä»Šæ—¥è©³ç´°æµæ°´å¸³</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-zinc-900 text-white text-sm">
                        <tr>
                            <th class="p-4">ä¸‹å–®æ™‚é–“</th>
                            <th class="p-4">é¡å‹/æ¡Œè™Ÿ</th>
                            <th class="p-4">å“é …å…§å®¹</th>
                            <th class="p-4 text-right">é‡‘é¡</th>
                        </tr>
                    </thead>
                    <tbody id="admin-order-list" class="divide-y divide-zinc-100">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- æ²¿ç”¨æ‚¨ index.html çš„ Firebase é…ç½® ---
        const firebaseConfig = {
            apiKey: "AIzaSyAQmRJyaxZ2U8EhUz_zxXAp9TgzrMQ54eg",
            authDomain: "tureyuhotpot.firebaseapp.com",
            projectId: "tureyuhotpot",
            storageBucket: "tureyuhotpot.firebasestorage.app",
            messagingSenderId: "883173642278",
            appId: "1:883173642278:web:6c3d091b59f7b0d35c96e7",
            databaseURL: "https://tureyuhotpot-default-rtdb.firebaseio.com"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.database();

        // ç›£è½ç•¶å¤©è¨‚å–®
        db.ref('orders').on('value', (snapshot) => {
            const orders = snapshot.val();
            const listContainer = document.getElementById('admin-order-list');
            const totalRevenueEl = document.getElementById('total-revenue');
            const totalOrdersEl = document.getElementById('total-orders');

            if (!orders) {
                listContainer.innerHTML = '<tr><td colspan="4" class="p-10 text-center text-zinc-400">ä»Šæ—¥å°šç„¡ç‡Ÿæ”¶æ•¸æ“š</td></tr>';
                totalRevenueEl.innerText = '0';
                totalOrdersEl.innerText = '0';
                return;
            }

            let totalRevenue = 0;
            let orderCount = 0;
            let rows = "";

            // å–å¾—ä»Šå¤©çš„æ—¥æœŸ (0æ™‚0åˆ†)
            const todayStart = new Date().setHours(0,0,0,0);

            // è™•ç†è³‡æ–™ä¸¦æ’åº (æ–°çš„åœ¨å‰)
            Object.keys(orders).reverse().forEach(id => {
                const order = orders[id];
                
                // åªçµ±è¨ˆä»Šå¤©çš„è¨‚å–®
                if (order.createdAt >= todayStart) {
                    totalRevenue += (order.total || 0);
                    orderCount++;

                    const time = new Date(order.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    const itemsNames = order.items ? order.items.map(i => i.name).join(', ') : '-';
                    
                    rows += `
                        <tr class="hover:bg-zinc-50 transition-all">
                            <td class="p-4 text-sm text-zinc-500">${time}</td>
                            <td class="p-4 font-bold text-zinc-800 text-sm">[${order.type}] ${order.table}</td>
                            <td class="p-4 text-xs text-zinc-600">${itemsNames}</td>
                            <td class="p-4 text-right font-black text-red-600">$${order.total.toLocaleString()}</td>
                        </tr>
                    `;
                }
            });

            totalRevenueEl.innerText = totalRevenue.toLocaleString();
            totalOrdersEl.innerText = orderCount;
            listContainer.innerHTML = rows || '<tr><td colspan="4" class="p-10 text-center text-zinc-400">ä»Šæ—¥å°šç„¡ç‡Ÿæ”¶æ•¸æ“š</td></tr>';
        });
    </script>
</body>
</html>
